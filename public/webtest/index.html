<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="css/pure-min.css">
<link rel="stylesheet" href="css/styles.css">
<title>carnation webtest</title>
<script src="js/jquery-2.1.0.js"></script>
<script src="js/jquery.collapse.js"></script>
<script src="js/base64.js"></script>
<script src="js/carnation.js"></script>
<script>
  var carnation = window.carnation;

  var reset_tokens = function() {
    reset_user_token();
    reset_viewer_token();
  }

  var reset_user_token = function() {
    console.log( "reset user token" );
    carnation.reset_user_token();
    $("#get_user_token").find("#user_id").text('');
    $("#get_user_token").find("#token").text('');
    $("#get_user_token").find("#token_type").text('');
    $("#get_user_token").find("#scope").text('');
    $("#get_user_token").find("#valid_until").text('');
  }

  var reset_viewer_token = function(event) {
    console.log( "reset viewer token" );
    carnation.reset_viewer_token();
    $("#get_viewer_token").find("#viewer_id").text('');
    $("#get_viewer_token").find("#token").text('');
    $("#get_viewer_token").find("#token_type").text('');
    $("#get_viewer_token").find("#scope").text('');
    $("#get_viewer_token").find("#valid_until").text('');
  }

  var get_user_token = function(form) {
    var email = $(form).find('*[name=email]')[0].value;
    var password = $(form).find('*[name=password]')[0].value;
    carnation.get_user_token(email, password, function(token) {
      carnation.user_token = token.access_token;
      $(form).find("#user_id").text(token.user_id)
      $(form).find("#token").text(token.access_token)
      $(form).find("#token_type").text(token.token_type)
      $(form).find("#scope").text(token.scope)
      $(form).find("#valid_until").text(new Date(parseInt(token.valid_until)))
      $('*[name="user_id"]').val(token.user_id);
    });
  }

  var get_viewer_token = function(form) {
    var appid = $(form).find('*[name=appid]')[0].value;
    var secret = $(form).find('*[name=secret]')[0].value;

    console.log("appid=" + appid);
    console.log("secret=" + secret);
    var auth = Base64.encode(appid + ":" + secret);
    carnation.get_viewer_token("Basic " + auth, function(token) {
      carnation.viewer_token = token.access_token;
      $(form).find("#viewer_id").text(token.viewer_id)
      $(form).find("#token").text(token.access_token)
      $(form).find("#token_type").text(token.token_type)
      $(form).find("#scope").text(token.scope)
      $(form).find("#valid_until").text(new Date(parseInt(token.valid_until)))
      $('*[name="viewer_id"]').val(token.viewer_id);
    });
  }

$(document).ready(function() {

  get_user_token($('#get_user_token'));
  get_viewer_token($('#get_viewer_token'));

  $("#get_user_token").submit( function (event) {
    console.log( "get user token" );
    event.preventDefault();
    get_user_token(this);
  });

  $("#get_viewer_token").submit( function (event) {
    console.log( "get viewer token" );
    event.preventDefault();
    get_viewer_token(this);
  });

  $(".carnation_api").submit( function (event) {
    console.log( "carnation_api" );
    event.preventDefault();
    var form = $(this);
    var tokentype = $(form).find("input:checked")[0].value;
    var token;
    if (tokentype == "user")
        token = carnation.user_token;
    else
        token = carnation.viewer_token;

    console.log("calling api token=" + token);
    carnation.callapi(form, token);
  });

});
</script>

</head>
<body>
  <h3>carnation api test</h3>

<div data-collapse>
    <h4>retrieve access token for user</h4>
    <form class="pure-form pure-form-aligned" id="get_user_token" action="/token" method="post">
      <fieldset>
        <div class="pure-control-group">
            <label for="email">email</label>
            <input id="email" type="text" value="test01@chikaku.com" name="email">
        </div>
        <div class="pure-control-group">
            <label for="password">password</label>
            <input id="password" type="text" value="dx7PnxqDZ5kr" name="password">
        </div>
        <ul>
          <li>user_id=<span id="user_id"></span></li>
          <li>token=<span id="token"></span></li>
          <li>scope=<span id="scope"></span></li>
          <li>token_type=<span id="token_type"></span></li>
          <li>valid until: <span id="valid_until"></span></li>
        </ul>
        <input class="pure-button pure-button-primary" type="submit" value="retrieve user token"/>
      </fieldset>
    </form>
</div>

<div data-collapse>
    <h4>retrieve access token for viewer</h4>
    <form class="pure-form pure-form-aligned" id="get_viewer_token" action="/token" method="post">
      <fieldset>
        <div class="pure-control-group">
          <label for="appid">appid</label>
          <input id="appid" type="text" value="6052d5885f9c2a12c09ef90f815225d3" name="appid" size="40"/>
        </div>
        <div class="pure-control-group">
          <label for="secret">secret</label>
          <input id="secret" type="text" value="f6af879a7db8bfbe183e08c1a68e9035" name="secret" size="40"/>
        </div>
        <ul>
          <li>viewer_id=<span id="viewer_id"></span></li>
          <li>token=<span id="token"></span></li>
          <li>scope=<span id="scope"></span></li>
          <li>token_type= <span id="token_type"></span></li>
          <li>valid until: <span id="valid_until"></span></li>
        </ul>
        <input class="pure-button pure-button-primary" type="submit" value="retrieve viewer token">
      </fieldset>
    </form>
</div>

    <form action="result.html" method="get" target="result">
      <input class="pure-button" type="button" value="clear token" onclick="reset_tokens()">
      <input class="pure-button" type="submit" value="open result window"/>
    </form>
    <hr/>

<h3>query user</h3>

<div data-collapse>
    <h4>get user info</h4>
    <form class="carnation_api pure-form pure-form-aligned" action="/api/v1/user" method="get" id="upload">
      <fieldset>
        <div class="pure-control-group">
          <label>user_id</label> <input type="text" name="user_id"/>
        </div>
        <div class="pure-control-group">
          <label>email</label> <input type="text" name="email"/>
        </div>
        <textarea id="description" readonly cols="60" rows="3" >method,url,parameters are shown here</textarea><br/>
        <input class="pure-button pure-button-primary" type="submit" value="submit">
        <input type="radio" name="tokentype" value="user" checked>as user</input>
        <input type="radio" name="tokentype" value="viewer">as viewer</input>
      </fieldset>
    </form>
</div>

<h3>upload item</h3>

<div data-collapse>
    <h4>initiate item upload</h4>
    <form class="carnation_api pure-form pure-form-aligned" action="/api/v1/item/initiate" method="post" id="upload">
      <fieldset>
        <div class="pure-control-group">
          <label>user_id(mandatory)</label> <input type="text" name="user_id"/>
        </div>
        <div class="pure-control-group">
          <label>item_id (optional)</label> <input type="text" name="item_id"/>
        </div>
        <div class="pure-control-group">
          <label>title</label> <input type="text" name="title"/>
        </div>
        <div class="pure-control-group">
          <label>description</label> <input type="text" name="description"/>
        </div>
        <div class="pure-control-group">
          <label>width</label> <input type="number" name="width"/>
        </div>
        <div class="pure-control-group">
          <label>height</label> <input type="number" name="height"/>
        </div>
        <div class="pure-control-group">
          <label>extension</label>
          <select name="extension">
            <option value=".jpg">.jpg</option>
            <option value=".png">.png</option>
            <option value=".mp4">.mp4</option>
          </select>
        </div>
        <textarea id="description" readonly cols="60" rows="3" >method,url,parameters are shown here</textarea><br/>
        <input class="pure-button pure-button-primary" type="submit" value="submit">
        <input type="radio" name="tokentype" value="user" checked>as user</input>
      </fieldset>
    </form>
</div>
<div data-collapse>
    <h4>initiate item upload with browser (test purpose only) </h4>
    <form class="pure-form pure-form-aligned" action="/api/v1/item/initiate_post" method="post" target="upload">
      <fieldset>
        <div class="pure-control-group">
          <label>user_id</label><input type="text" name="user_id" />
        </div>
        <div class="pure-control-group">
          <label>item_id</label><input type="text" name="item_id" />
        </div>
        <div class="pure-control-group">
          <label>extension</label>
          <select name="extension">
            <option value=".jpg">.jpg</option>
            <option value=".png">.png</option>
            <option value=".mp4">.mp4</option>
          </select>
        </div>
        <input class="pure-button pure-button-primary" type="submit" value="submit">
        <input type="radio" name="tokentype" value="user" checked>as user</input>
      </fieldset>
    </form>
</div>

<div data-collapse>
    <h4>notify upload completed</h4>
    <form class="carnation_api pure-form pure-form-aligned" action="/api/v1/item/uploaded" method="put">
      <fieldset>
        <div class="pure-control-group">
          <label>item_id</label><input type="text" name="item_id"/>
        </div>
        <div class="pure-control-group">
          <label>valid_after</label><input type="text" name="valid_after"/>
        </div>
        <textarea id="description" readonly cols="60" rows="3" >method,url,parameters are shown here</textarea><br/>
        <input class="pure-button pure-button-primary" type="submit" value="submit">
        <input type="radio" name="tokentype" value="user" checked>as user</input>
        <input type="radio" name="tokentype" value="viewer">as viewer</input>
      </fieldset>
    </form>
</div>

<h3>get items</h3>

<div data-collapse>
    <h4>get_user_images</h4>
    <form class="carnation_api pure-form pure-form-aligned" action="/api/v1/user/images" method="get">
      <fieldset>
        <div class="pure-control-group">
          <label>user_id</label><input type="text" name="user_id"/>
        </div>
        <div class="pure-control-group">
          <label>item_id</label><input type="text" name="item_id" />
        </div>
        <div class="pure-control-group">
          <label>count</label><input type="number" name="count" />
        </div>
        <div class="pure-control-group">
          <label>greater_than</label><input type="number" name="greater_than" />
        </div>
        <div class="pure-control-group">
          <label>less_than</label><input type="number" name="less_than" />
        </div>
        <div class="pure-control-group">
          <label>created_after</label><input type="number" name="created_after" />
        </div>
        <div class="pure-control-group">
          <label>created_before</label><input type="number" name="created_before" />
        </div>
        <div class="pure-control-group">
          <label>offset</label><input type="number" name="offset" />
        </div>
        <div class="pure-control-group">
          <label>ignore status</label>
          <select name="ignore_status">
            <option value=""></option>
            <option value="true">true</option>
            <option value="false">false</option>
          </select>
        </div>
        <div class="pure-control-group">
          <label>ignore valid_after</label>
          <select name="ignore_valid_after">
            <option value=""></option>
            <option value="true">true</option>
            <option value="false">false</option>
          </select>
        </div>
        <textarea id="description" readonly cols="60" rows="3" >method,url,parameters are shown here</textarea><br/>
        <input class="pure-button pure-button-primary" type="submit" value="submit">
        <input type="radio" name="tokentype" value="user" checked>as user</input>
        <input type="radio" name="tokentype" value="viewer">as viewer</input>
      </fieldset>
    </form>
</div>

<h3>viewer api</h3>

<div data-collapse>
    <h4>get users that can be accessed by viewer</h4>
    <form class="carnation_api pure-form pure-form-aligned" action="/api/v1/viewer/users" method="get">
      <fieldset>
        <textarea id="description" readonly cols="60" rows="3" >method,url,parameters are shown here</textarea><br/>
        <input class="pure-button pure-button-primary" type="submit" value="submit">
        <input type="radio" name="tokentype" value="user">as user</input>
        <input type="radio" name="tokentype" value="viewer" checked>as viewer</input>
      </fieldset>
    </form>
</div>

<div data-collapse>
    <h4>post viewer likes item</h4>
    <form class="carnation_api pure-form pure-form-aligned" action="/api/v1/viewer/like" method="post">
      <fieldset>
        <div class="pure-control-group">
          <label>item_id</label><input type="text" name="item_id"/>
        </div>
        <textarea id="description" readonly cols="60" rows="3" >method,url,parameters are shown here</textarea><br/>
        <input class="pure-button pure-button-primary" type="submit" value="submit">
        <input type="radio" name="tokentype" value="user">as user</input>
        <input type="radio" name="tokentype" value="viewer" checked>as viewer</input>
      </fieldset>
    </form>
</div>

<div data-collapse>
    <h4>get viewer info</h4>
    <form class="carnation_api pure-form pure-form-aligned" action="/api/v1/viewer" method="get">
      <fieldset>
        <div class="pure-control-group">
          <label>viewer_id</label><input type="text" name="viewer_id"/>
        </div>
        <textarea id="description" readonly cols="60" rows="3" >method,url,parameters are shown here</textarea><br/>
        <input class="pure-button pure-button-primary" type="submit" value="submit">
        <input type="radio" name="tokentype" value="user">as user</input>
        <input type="radio" name="tokentype" value="viewer" checked>as viewer</input>
      </fieldset>
    </form>
</div>

</body>
</html>
